# 上下文管理 - 快速入门

## 🚀 5 分钟上手

### 步骤 1：打开上下文面板

在 CodeAssistant 页面，点击工具栏的 **"上下文"** 按钮：

```
[会话历史] [配置] [上下文] [清空]
                    ↑
                  点这里
```

### 步骤 2：查看当前上下文

面板会显示：
- 📊 Token 使用情况
- 📝 所有上下文项列表
- 🏷️ 每项的类型和优先级

### 步骤 3：管理上下文项

**包含/排除项：**
- ✅ 勾选 = 包含在上下文中
- ⬜ 取消勾选 = 排除（不发送给 AI）

**调整优先级：**
- 🔼 点击向上箭头 = 提高优先级
- 🔽 点击向下箭头 = 降低优先级

### 步骤 4：压缩上下文（可选）

当 Token 使用率过高时：

1. 点击 **压缩** 按钮
2. 选择压缩策略：
   - ⭐ **智能摘要**（推荐）
   - 📅 保留最近消息
   - 🎯 保留高优先级
   - 🔄 移除重复
3. 点击 **开始压缩**

## 💡 实用技巧

### 技巧 1：快速排除旧消息

```
1. 打开上下文面板
2. 找到旧的对话
3. 点击复选框取消勾选
4. Token 使用率立即下降 ✨
```

### 技巧 2：保留重要代码

```
1. 找到包含关键代码的上下文项
2. 点击 🔼 提高优先级到 8-10
3. 压缩时会优先保留 🎯
```

### 技巧 3：搜索特定内容

```
1. 在搜索框输入关键词（如 "function"）
2. 只显示匹配的上下文项
3. 快速定位需要的内容 🔍
```

### 技巧 4：按类型筛选

```
1. 点击类型下拉框
2. 选择 "代码片段"
3. 只显示代码相关的项 📝
```

## 📈 效果对比

### 使用前：
```
Token 使用: 95,000 / 100,000 (95%)
上下文项: 50 个
问题: Token 快用完了，AI 可能会忘记之前的内容
```

### 使用后（智能压缩）：
```
Token 使用: 65,000 / 100,000 (65%)
上下文项: 35 个（保留了重要的 15 个，压缩了 20 个）
效果: 节省了 30,000 tokens，AI 仍然记得关键信息 ✅
```

## ⚡ 常见场景

### 场景 A：开始新话题

**操作：**
1. 排除之前话题的所有消息
2. 或使用 "保留最近消息" 压缩
3. Token 使用率降到 20-30%

### 场景 B：调试代码

**操作：**
1. 保留错误消息（自动高优先级）
2. 保留相关代码片段
3. 排除无关的历史对话

### 场景 C：长期项目

**操作：**
1. 定期导出上下文（作为文档）
2. 每周压缩一次
3. 重要代码设置高优先级

## 🎓 进阶使用

### 编程式添加上下文

```csharp
// 添加工作区文件
await ContextManagerService.AddWorkspaceFileToContextAsync(
    sessionId, 
    "src/components/Button.tsx"
);

// 批量添加
await ContextManagerService.AddWorkspaceFilesToContextAsync(
    sessionId,
    new List<string> { "README.md", "package.json", "tsconfig.json" }
);
```

### 自定义上下文项

```csharp
var item = new ContextItem
{
    Type = ContextItemType.CodeSnippet,
    Content = "// 重要的配置代码\nconst API_KEY = '...'",
    Language = "javascript",
    Priority = 9,
    Tags = new List<string> { "config", "important" },
    Summary = "API 配置"
};

ContextManagerService.AddContextItem(sessionId, item);
```

## 📱 移动端提示

在移动设备上：
- 上下文面板会全屏显示
- 点击区域更大（44x44px）
- 支持触摸滚动
- 自动适应屏幕大小

## ❓ 常见问题

**Q: 压缩后 AI 会忘记之前的内容吗？**  
A: 不会。智能压缩会保留关键信息的摘要，AI 仍然能理解上下文。

**Q: 多久压缩一次比较好？**  
A: 系统会在 Token 使用率达到 80% 时自动压缩。手动压缩建议在开始新话题时进行。

**Q: 排除的消息会被删除吗？**  
A: 不会。排除只是不发送给 AI，消息仍然保存在会话历史中。

**Q: 如何恢复被压缩的内容？**  
A: 压缩是不可逆的。建议在压缩前导出上下文作为备份。

## 🎯 下一步

- 阅读 [完整功能说明](./上下文管理功能说明.md)
- 查看 [最佳实践](./上下文管理最佳实践.md)
- 尝试 [高级用法](#进阶使用)

---

**需要帮助？** 查看 [故障排除](./上下文管理功能说明.md#故障排除) 或提交 Issue。

