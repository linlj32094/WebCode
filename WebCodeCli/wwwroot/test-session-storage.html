<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Session Storage 测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Session Storage 功能测试</h1>
    
    <div id="results"></div>
    
    <button onclick="testSaveSessions()">测试保存会话</button>
    <button onclick="testLoadSessions()">测试加载会话</button>
    <button onclick="testStorageInfo()">测试存储信息</button>
    <button onclick="clearAll()">清空所有</button>

    <script src="./js/session-storage.js"></script>
    <script>
        const resultsDiv = document.getElementById('results');

        function addResult(message, isSuccess) {
            const div = document.createElement('div');
            div.className = `test-result ${isSuccess ? 'success' : 'error'}`;
            div.textContent = message;
            resultsDiv.appendChild(div);
        }

        function testSaveSessions() {
            try {
                const testSessions = [
                    {
                        sessionId: 'test-1',
                        title: '测试会话 1',
                        workspacePath: 'C:\\test',
                        messages: [],
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString(),
                        isWorkspaceValid: true
                    }
                ];

                const result = window.webCliSessionStorage.saveSessions(testSessions);
                addResult(`保存会话: ${result ? '成功' : '失败'}`, result);
            } catch (e) {
                addResult(`保存会话失败: ${e.message}`, false);
            }
        }

        function testLoadSessions() {
            try {
                const sessions = window.webCliSessionStorage.loadSessions();
                addResult(`加载会话成功，共 ${sessions.length} 个会话`, true);
                console.log('加载的会话:', sessions);
            } catch (e) {
                addResult(`加载会话失败: ${e.message}`, false);
            }
        }

        function testStorageInfo() {
            try {
                const info = window.webCliSessionStorage.getStorageInfo();
                addResult(`存储信息: ${info.usedMB}MB / ${info.limitMB}MB (${info.percentage}%)`, true);
            } catch (e) {
                addResult(`获取存储信息失败: ${e.message}`, false);
            }
        }

        function clearAll() {
            try {
                window.webCliSessionStorage.clearSessions();
                addResult('清空所有会话成功', true);
            } catch (e) {
                addResult(`清空失败: ${e.message}`, false);
            }
        }

        // 页面加载时检查
        window.addEventListener('load', function() {
            if (typeof window.webCliSessionStorage !== 'undefined') {
                addResult('✓ webCliSessionStorage 对象已正确加载', true);
            } else {
                addResult('✗ webCliSessionStorage 对象未找到', false);
            }
        });
    </script>
</body>
</html>
